<?php  
    session_start();

    // Colocar aqui a condição !isset ajustada ao PDO
    // "SELECT * FROM users WHERE user_id = :user_id" 
    // Redireccionar para location: erro_acesso.html (falta criar a página de erro)
?>
<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O meu perfil</title>
    <link href="styles/main.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Conecta à base de dados -->
<?php  include 'includes/connect_db.php';?>

<!-- Barra de navegação superor (falta optimizar: SVGs, php em include )-->
<header>  
    <nav class="wrapper">
    <!-- Desenha o logo directamente no browser -->
    <a id="xata-logo" href="main.php">
        <svg width="33.107533mm" height="10.397141mm" viewBox="0 0 33.107532 10.39714" version="1.1" id="logo" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
        <defs id="xata-logo" />
        <g transform="matrix(1.3391456,0,0,1.3391456,-160.47482,-213.50275)">
        <g transform="matrix(0.75821101,0,0,0.75821101,27.058666,98.033952)">
        <path d="m 151.69292,84.481919 c -1.81128,0 -3.2656,1.513437 -3.2656,3.367794 0,1.86799 1.45432,3.367799 3.2656,3.367799 0.68748,0 1.53359,-0.395416 1.89056,-0.899907 0.0265,-0.02724 0.0662,-0.01362 0.0662,0.02724 l 0.0132,0.599938 c 0.0132,0.149988 0.1323,0.272713 0.26451,0.272713 h 0.70075 c 0.15865,0 0.27752,-0.122725 0.27752,-0.272713 0,0 0.11904,-1.472589 0.0264,-3.258775 -0.0793,-1.786179 -1.49394,-3.204104 -3.2391,-3.204104 z m -0.0268,1.361085 c 1.17371,-0.0087 2.10496,1.038653 1.94383,2.2658 -0.10577,0.8999 -0.8065,1.622591 -1.66586,1.731673 -1.26921,0.163617 -2.3402,-0.940892 -2.18155,-2.249849 0.10577,-0.899907 0.8065,-1.608957 1.66586,-1.731674 0.0802,-0.01023 0.15946,-0.01535 0.23772,-0.01593 z" />
        <path d="m 139.04048,84.481919 c -1.81128,0 -3.26559,1.513437 -3.26559,3.367794 0,1.86799 1.45431,3.367799 3.26559,3.367799 0.68749,0 1.5336,-0.395416 1.89056,-0.899907 0.0264,-0.02724 0.0662,-0.01362 0.0662,0.02724 l 0.0132,0.599938 c 0.0132,0.149988 0.1323,0.272713 0.26451,0.272713 h 0.70059 c 0.15865,0 0.27767,-0.122725 0.27767,-0.272713 0,0 0.11904,-1.472589 0.0265,-3.258775 -0.0793,-1.786179 -1.49394,-3.204104 -3.23911,-3.204104 z m -0.0268,1.361085 c 1.17371,-0.0087 2.10497,1.038653 1.94384,2.2658 -0.10577,0.8999 -0.80649,1.622591 -1.66586,1.731673 -1.26922,0.163617 -2.34021,-0.940892 -2.18155,-2.249849 0.10577,-0.899907 0.8065,-1.608957 1.66586,-1.731674 0.0802,-0.01023 0.15946,-0.01535 0.23771,-0.01593 z" />
        <path d="m 144.91055,80.977605 c -0.13221,0 -0.23803,0.09548 -0.23803,0.23183 l -0.0396,2.181544 v 1.158992 l -1.3089,0.04093 c -0.13221,0.01362 -0.22471,0.109103 -0.22471,0.245456 v 0.818139 c 0,0.122717 0.0925,0.218042 0.22471,0.231677 l 1.3089,0.04108 v 2.863258 l 0.0396,2.195331 c 0,0.12271 0.10582,0.23167 0.23803,0.23167 h 0.76673 c 0.11898,0 0.22486,-0.10896 0.22486,-0.23167 l 0.0528,-2.195331 v -2.863254 l 1.3089,-0.04108 c 0.11899,-0.01362 0.2247,-0.108952 0.2247,-0.245305 v -0.804511 c 0,-0.136353 -0.10571,-0.231821 -0.2247,-0.245456 l -1.3089,-0.04093 v -1.158992 l -0.0528,-2.181544 c 0,-0.136346 -0.10588,-0.231829 -0.22486,-0.231829 z" />
        <path d="m 133.75347,83.313579 v 9.31e-4 c -0.0419,4.16e-4 -0.0839,0.01395 -0.12219,0.04053 l -1.72493,1.215259 -1.83728,1.324932 c -0.15413,0.115849 -0.62326,0.463832 -0.95641,0.726295 -0.15247,0.140895 -0.34744,0.320575 -0.44764,0.595052 0.0585,0.162803 0.15064,0.4789 0.44764,0.689416 0.33315,0.262463 0.80229,0.610487 0.95641,0.726295 l 1.83728,1.324023 1.72493,1.216188 c 0.0513,0.03568 0.10892,0.04765 0.1636,0.03688 0.007,-0.0017 0.0138,-0.0033 0.0206,-0.0055 l -0.001,-0.0011 c 0.047,-0.01395 0.0905,-0.04629 0.12413,-0.09445 l 0.42336,-0.678655 c 0.0763,-0.109934 0.0485,-0.248124 -0.0585,-0.332573 l -1.68715,-1.270103 -2.03323,-1.488522 c -0.0477,-0.02769 -0.0863,-0.05203 -0.11777,-0.07549 0.0314,-0.02364 0.0699,-0.04853 0.11777,-0.07637 l 2.03323,-1.488523 1.68715,-1.27101 c 0.10699,-0.08454 0.13478,-0.221652 0.0585,-0.33167 l -0.42336,-0.678651 c -0.0333,-0.04819 -0.077,-0.08019 -0.12413,-0.09445 l 0.001,-9.3e-4 c -0.007,-0.0018 -0.0138,-0.0035 -0.0206,-0.0053 -0.0138,-0.0035 -0.0274,-0.0035 -0.0413,-0.0035 z" />
        <path d="m 123.01225,83.313579 v 9.31e-4 c 0.0419,4.16e-4 0.0839,0.01395 0.12219,0.04053 l 1.72493,1.215259 1.83728,1.324932 c 0.15413,0.115849 0.62326,0.463832 0.95641,0.726295 0.15247,0.140895 0.34744,0.320575 0.44764,0.595052 -0.0585,0.162803 -0.15064,0.4789 -0.44764,0.689416 -0.33315,0.262463 -0.80229,0.610487 -0.95641,0.726295 l -1.83728,1.324023 -1.72493,1.216188 c -0.0513,0.03568 -0.10892,0.04765 -0.1636,0.03688 -0.007,-0.0017 -0.0138,-0.0033 -0.0206,-0.0055 l 0.001,-0.0011 c -0.047,-0.01395 -0.0905,-0.04629 -0.12413,-0.09445 l -0.42336,-0.678655 c -0.0763,-0.109934 -0.0485,-0.248124 0.0585,-0.332573 l 1.68715,-1.270103 2.03323,-1.488522 c 0.0477,-0.02769 0.0863,-0.05203 0.11777,-0.07549 -0.0314,-0.02364 -0.0699,-0.04853 -0.11777,-0.07637 l -2.03323,-1.488523 -1.68715,-1.27101 c -0.10699,-0.08454 -0.13478,-0.221652 -0.0585,-0.33167 l 0.42336,-0.678651 c 0.0333,-0.04819 0.077,-0.08019 0.12413,-0.09445 l -0.001,-9.3e-4 c 0.007,-0.0018 0.0138,-0.0035 0.0206,-0.0053 0.0138,-0.0035 0.0274,-0.0035 0.0413,-0.0035 z" />
        </g>
        </g>
        </svg>
    </a>

    <div class="rightnav">
    <!-- Caixa de pesquisa-->
    <input type="search" id="xata-search" name="xata-pesquisa" placeholder="Procuras alguma coisa?"/><button >Procurar</button> 
    
    <!-- Mostra especificamente o avatar do utilizador ID 3: MUDAR PARA OS DADOS DE SESSÃO INICIADA PELO PDO -->
    <?php
        $sql = "SELECT avatar FROM profiles
        WHERE user_id=3";                       //estou a ir buscar o avatar de um user em específico (ID 3) para testar o PDO -MUDAR PARA OS DADOS DE SESSÃO INICIADA :user_id, $connection->lastInsertId()
        $getAvatar = $connection->prepare($sql);
        $getAvatar->execute();
    ?>
    <a href="perfil.php"><img src="users/rayana/<?php echo $getAvatar->fetchColumn(); ?>" /></a>

    <!-- Desenha o ícone de notificações directamente no browser -->
    <a href="notifs.php">
        <svg class="icon" width="7.3377991mm" height="7.8125763mm" viewBox="0 0 7.3377991 7.8125763" version="1.1" id="logo" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
        <defs id="notif" />
        <g transform="translate(-201.62113,-200.55847)">
        <path d="m 204.75264,208.34519 c -0.49246,-0.10362 -0.81174,-0.42402 -0.81174,-0.81453 v -0.10498 h 1.30716 1.30718 l -2.8e-4,0.0829 c -8.4e-4,0.31331 -0.27249,0.66049 -0.61082,0.78045 -0.21201,0.0752 -0.93859,0.10945 -1.19157,0.0562 z m -3.13151,-1.70461 c 0,-0.42302 0.0636,-0.58343 0.36571,-0.92169 0.39773,-0.44541 0.38455,-0.39443 0.41098,-1.58875 0.0221,-0.99835 0.0265,-1.04487 0.13726,-1.46846 0.2277,-0.87052 0.61983,-1.46136 1.20024,-1.8016 0.55891,-0.32553 1.14846,-0.29873 1.51274,-0.29927 0.62822,-0.0141 1.05463,0.0284 1.53794,0.31334 0.46463,0.27634 0.8365,0.70673 1.0491,1.2278 0.17021,0.41709 0.22722,0.8163 0.26866,1.8809 0.05,1.28699 0.0784,1.39281 0.477,1.78585 0.24178,0.2384 0.33679,0.46466 0.35946,0.85611 l 0.0187,0.32219 h -3.66887 -3.66887 z" />
        </g>
        </svg>
    </a>
    <!-- Desenha o ícone de configurações directamente no browser -->
    <a href="config.php">
        <svg class="icon" width="7.7798309mm" height="7.7769318mm" viewBox="0 0 7.7798309 7.7769318" version="1.1" id="logo" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
        <defs id="settings" />
        <g transform="translate(-148.19704,-175.04075)">
        <path d="m 151.55245,182.59721 c -0.0372,-0.12138 -0.12544,-0.41099 -0.19619,-0.64357 l -0.12856,-0.42288 -0.24128,-0.10003 -0.24128,-0.10002 -0.54762,0.28269 c -0.30117,0.15547 -0.57288,0.282 -0.60379,0.28116 -0.0309,-8e-4 -0.17716,-0.11773 -0.32504,-0.2597 l -0.26886,-0.25818 0.32161,-0.61117 0.32164,-0.61117 -0.0807,-0.23363 -0.0806,-0.23362 -0.63057,-0.19601 -0.63057,-0.19603 -0.0118,-0.41454 -0.0118,-0.41456 0.36919,-0.1116 c 0.20305,-0.0614 0.50174,-0.15143 0.66373,-0.20017 0.29166,-0.0877 0.29543,-0.0908 0.38539,-0.30835 l 0.0909,-0.21971 -0.30949,-0.59198 -0.30952,-0.59196 0.29334,-0.29083 0.29333,-0.29083 0.21932,0.11786 c 0.12059,0.0648 0.38528,0.2041 0.58812,0.30952 l 0.36881,0.19169 0.24947,-0.0933 c 0.20893,-0.0782 0.25611,-0.11473 0.29036,-0.22547 0.0226,-0.0727 0.10911,-0.35443 0.19241,-0.62612 l 0.15151,-0.49394 h 0.40914 0.40915 l 0.18487,0.61443 0.18488,0.61442 0.26975,0.121 0.26974,0.12099 0.53694,-0.27304 c 0.29531,-0.15016 0.55443,-0.27302 0.57582,-0.27302 0.0214,0 0.16127,0.1236 0.31088,0.27468 l 0.27204,0.27467 -0.29018,0.55557 -0.29019,0.55559 0.11747,0.2999 c 0.11069,0.28257 0.1274,0.30282 0.29018,0.35026 0.0951,0.0277 0.35717,0.10703 0.5826,0.17629 l 0.40988,0.12595 v 0.41065 0.41064 l -0.60152,0.18155 -0.60151,0.18156 -0.1325,0.2911 -0.1325,0.2911 0.28925,0.53222 0.28927,0.53223 -0.29245,0.29427 -0.29243,0.29426 -0.56366,-0.29291 -0.56364,-0.29289 -0.22305,0.0783 c -0.3261,0.1146 -0.35762,0.13606 -0.38901,0.26458 -0.0156,0.0642 -0.0947,0.32954 -0.17531,0.58964 l -0.14683,0.47293 h -0.41037 -0.41037 z m 1.12699,-2.4436 c 0.30485,-0.14195 0.50012,-0.33031 0.64687,-0.62401 0.11121,-0.22264 0.12805,-0.30101 0.12765,-0.59643 -3.2e-4,-0.27165 -0.021,-0.38439 -0.10284,-0.56023 -0.31217,-0.67048 -1.129,-0.96454 -1.77818,-0.64011 -0.27842,0.13912 -0.49934,0.3561 -0.64919,0.63766 -0.0796,0.14962 -0.0961,0.24534 -0.0961,0.5589 7e-5,0.32911 0.0147,0.40628 0.11303,0.59304 0.13835,0.26316 0.47885,0.57708 0.71762,0.66162 0.28744,0.1018 0.76795,0.0874 1.02114,-0.0304 z"/>
        </g>
        </svg>
    </a>
    <a href="logout.php">Terminar sessão</a>
    </div>
    </nav>  
</header>  

 <!-- PERFIL DO UTILIZADOR: parte superior com CAPA, avatar, nome, handle, publicações, favoritos,seguindo e seguidores  -->
 <div class="usr-cover">
    <?php
        //selecciona os dados da tabela Perfis do utilizador com id 3
        $getProfile = $connection->prepare("SELECT * FROM profiles WHERE user_id=3"); //mudar para o id da sessão
        $getProfile->execute();
        
        //mostra os dados do user com id 3
        while($userData = $getProfile->fetch(PDO::FETCH_ASSOC)){
            echo "<img  src='users/" .$userData['name']. "/header_photo.png' /></div><br/>";
    ?>
<div class='wrapper'>
    <?php
        echo "<div class='avatar-frame'><img src='users/rayana/" .$userData['avatar']. "' alt='avatar' /></div><br/>";
        echo "<h3>" .$userData['name']. "</h3><br/>";
        }
    ?>
</div>

</body>	
</html>    